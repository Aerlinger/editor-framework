<dom-module id="benchmark-multi-webview-webgl-panel1">
    <style type="text/css">
        #view-wrapper {
            width: 60%;
            height: 100%;
            float: left;
        }

        #content {
            width: 40%;
        }

    </style>
    <template>
        <div id='view-wrapper'>
            <webview id="view" src="../env/webgl.html" nodeintegration >
        </div>
        <div id='content'>
            <div>
                <button on-click='_onAddText'>Add Text</button>
                <span>{{texts.length}}</span>

                <button on-click='_onAddBunnies'>Add Bunnies</button>
                <span>{{bunnies}}</span>

                <button on-click='_onClear'>Clear</button>
            </div>
            
            <ul id='texts'>
                <template is="dom-repeat" id="list" items="{{texts}}">
                    <li>{{item}}</li>
                </template>
            </ul>
        </div>
    </template>
</dom-module>


<script>
Editor.registerPanel( 'benchmark-multi-webview-webgl.panel1', {
    is: 'benchmark-multi-webview-webgl-panel1',

    listeners: {
    },

    properties: {
        texts: {
            type: Array,
            value: function() {
                return [];
            },
            notify: true
        }
    },

    ready: function() {

        this.current = 0;
        this.bunnies = 0;

        setInterval(this.update.bind(this), 1000/60);

        this.$.view.addEventListener('ipc-message', function(event) {
            if (event.channel === 'bunnies-length:changed') {
                this.bunnies = event.args[0];
                EditorUI.update( this, 'bunnies' );  
            }
        }.bind(this));
    },

    update: function () {
        this.current ++;

        if (this.texts.length > 0) {
            for (var i = 0; i < this.texts.length; i++) {
                this.texts[i] = 'current : ' + this.current;
            }

            EditorUI.update( this, 'texts' );
        }
    },

    _onAddText: function () {
        Editor.sendToAll('texts:add');
    },

    _onAddBunnies: function () {
        Editor.sendToAll('bunnies:add');
    },

    _onClear: function () {
        Editor.sendToAll('panel:clear');
    },

    'bunnies:add': function () {
        this.$.view.send('add-bunnies');
    },

    'texts:add': function () {
        this.texts.length += 100;
    },

    'panel:clear': function () {
        this.texts.length = 0;
        this.$.view.send('clear-bunnies');

        EditorUI.update( this, 'texts' );
        EditorUI.update( this, 'bunnies' );
    }
});
</script>
