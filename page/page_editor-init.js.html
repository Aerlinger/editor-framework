<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Source: page/editor-init.js</title>
    
    
    
    
    
    <meta property="og:title" content=""/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content=""/>
    
    <meta property="og:url" content=""/>
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <script src="scripts/jquery.min.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/bootstrap.min.css">
    <link type="text/css" rel="stylesheet" href="styles/jaguar.css">
    
    
    <script>
    var config = {"monospaceLinks":false,"cleverLinks":false,"default":{"outputSourceFiles":true},"applicationName":"Editor (Page-Level)","footer":"Made with ♥ by <a href='http://fireball-x.com'>Fireball Team</a>","copyright":"Fireball Copyright © 2013-2015.","disqus":"","googleAnalytics":"","openGraph":{"title":"","type":"website","image":"","site_name":"","url":""},"meta":{"title":"","description":"","keyword":""},"linenums":true};
    </script>
    

    
</head>
<body>
<div id="wrap" class="clearfix">
    
<div class="navigation">
    <h3 class="applicationName"><a href="index.html">Editor (Page-Level)</a></h3>

    <div class="search">
        <input id="search" type="text" class="form-control input-sm" placeholder="Search Documentations">
    </div>
    <ul class="list">
    
        <li class="item" data-name="Editor.JS">
            <span class="title">
                <a href="Editor.JS.html">Editor.JS</a>
                
                <span class="static">static</span>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="Editor.JS.addon"><a href="Editor.JS.html#.addon">addon</a></li>
            
                <li data-name="Editor.JS.clear"><a href="Editor.JS.html#.clear">clear</a></li>
            
                <li data-name="Editor.JS.copyprop"><a href="Editor.JS.html#.copyprop">copyprop</a></li>
            
                <li data-name="Editor.JS.extend"><a href="Editor.JS.html#.extend">extend</a></li>
            
                <li data-name="Editor.JS.extract"><a href="Editor.JS.html#.extract">extract</a></li>
            
                <li data-name="Editor.JS.mixin"><a href="Editor.JS.html#.mixin">mixin</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="Editor.Selection">
            <span class="title">
                <a href="Editor.Selection.html">Editor.Selection</a>
                
                <span class="static">static</span>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="Editor.Selection.cancel"><a href="Editor.Selection.html#.cancel">cancel</a></li>
            
                <li data-name="Editor.Selection.clear"><a href="Editor.Selection.html#.clear">clear</a></li>
            
                <li data-name="Editor.Selection.confirm"><a href="Editor.Selection.html#.confirm">confirm</a></li>
            
                <li data-name="Editor.Selection.contexts"><a href="Editor.Selection.html#.contexts">contexts</a></li>
            
                <li data-name="Editor.Selection.curActivate"><a href="Editor.Selection.html#.curActivate">curActivate</a></li>
            
                <li data-name="Editor.Selection.curSelection"><a href="Editor.Selection.html#.curSelection">curSelection</a></li>
            
                <li data-name="Editor.Selection.filter"><a href="Editor.Selection.html#.filter">filter</a></li>
            
                <li data-name="Editor.Selection.hover"><a href="Editor.Selection.html#.hover">hover</a></li>
            
                <li data-name="Editor.Selection.hovering"><a href="Editor.Selection.html#.hovering">hovering</a></li>
            
                <li data-name="Editor.Selection.select"><a href="Editor.Selection.html#.select">select</a></li>
            
                <li data-name="Editor.Selection.setContext"><a href="Editor.Selection.html#.setContext">setContext</a></li>
            
                <li data-name="Editor.Selection.unselect"><a href="Editor.Selection.html#.unselect">unselect</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="Editor.Utils">
            <span class="title">
                <a href="Editor.Utils.html">Editor.Utils</a>
                
                <span class="static">static</span>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="Editor.Utils.formatFrame"><a href="Editor.Utils.html#.formatFrame">formatFrame</a></li>
            
                <li data-name="Editor.Utils.padLeft"><a href="Editor.Utils.html#.padLeft">padLeft</a></li>
            
                <li data-name="Editor.Utils.smoothScale"><a href="Editor.Utils.html#.smoothScale">smoothScale</a></li>
            
                <li data-name="Editor.Utils.wrapError"><a href="Editor.Utils.html#.wrapError">wrapError</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="Math">
            <span class="title">
                <a href="Math.html">Math</a>
                
                <span class="static">static</span>
                
            </span>
            <ul class="members itemMembers">
            
            <span class="subtitle">Members</span>
            
                <li data-name="Math.D2R"><a href="Math.html#.D2R">D2R</a></li>
            
                <li data-name="Math.HALF_PI"><a href="Math.html#.HALF_PI">HALF_PI</a></li>
            
                <li data-name="Math.R2D"><a href="Math.html#.R2D">R2D</a></li>
            
                <li data-name="Math.TWO_PI"><a href="Math.html#.TWO_PI">TWO_PI</a></li>
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="Math.calculateMaxRect"><a href="Math.html#.calculateMaxRect">calculateMaxRect</a></li>
            
                <li data-name="Math.clamp"><a href="Math.html#.clamp">clamp</a></li>
            
                <li data-name="Math.clamp01"><a href="Math.html#.clamp01">clamp01</a></li>
            
                <li data-name="Math.deg2rad"><a href="Math.html#.deg2rad">deg2rad</a></li>
            
                <li data-name="Math.deg180"><a href="Math.html#.deg180">deg180</a></li>
            
                <li data-name="Math.deg360"><a href="Math.html#.deg360">deg360</a></li>
            
                <li data-name="Math.lerp"><a href="Math.html#.lerp">lerp</a></li>
            
                <li data-name="Math.rad2deg"><a href="Math.html#.rad2deg">rad2deg</a></li>
            
                <li data-name="Math.rad180"><a href="Math.html#.rad180">rad180</a></li>
            
                <li data-name="Math.rad360"><a href="Math.html#.rad360">rad360</a></li>
            
                <li data-name="Math.randomRange"><a href="Math.html#.randomRange">randomRange</a></li>
            
                <li data-name="Math.randomRangeInt"><a href="Math.html#.randomRangeInt">randomRangeInt</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="Editor.IpcListener">
            <span class="title">
                <a href="Editor.IpcListener.html">Editor.IpcListener</a>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="Editor.IpcListener#clear"><a href="Editor.IpcListener.html#clear">clear</a></li>
            
                <li data-name="Editor.IpcListener#on"><a href="Editor.IpcListener.html#on">on</a></li>
            
                <li data-name="Editor.IpcListener#once"><a href="Editor.IpcListener.html#once">once</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
    </ul>
</div>
    <div class="main">
        <h1 class="page-title" data-filename="page_editor-init.js.html">Source: page/editor-init.js</h1>
        


    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>(function () {

var Remote = require('remote');
var Ipc = require('ipc');
var Util = require('util');
var Path = require('fire-path');
var Url = require('fire-url');
var Async = require('async');

/**
 * Page Level Editor
 */
window.Editor = window.Editor || {};

/**
 * Require module through url path
 * @param {string} url
 */
Editor.require = function ( path ) {
    return require( Editor.url(path) );
};

// DISABLE: use hash instead
// // init argument list sending from core by url?queries
// // format: '?foo=bar&amp;hell=world'
// // skip '?'
// var queryString = decodeURIComponent(location.search.substr(1));
// var queryList = queryString.split('&amp;');
// var queries = {};
// for ( var i = 0; i &lt; queryList.length; ++i ) {
//     var pair = queryList[i].split('=');
//     if ( pair.length === 2) {
//         queries[pair[0]] = pair[1];
//     }
// }
// NOTE: hash is better than query from semantic, it means this is client data.
if ( window.location.hash ) {
    var hash = window.location.hash.slice(1);
    Editor.argv = Object.freeze(JSON.parse(decodeURIComponent(hash)));
}
else {
    Editor.argv = {};
}

// init &amp; cache remote
Editor.remote = Remote.getGlobal('Editor');
Editor.cwd = Editor.remote.url('app://');
Editor.frameworkPath = Editor.remote.url('editor-framework://');
Editor.isDev = Editor.remote.isDev;

var _urlToPath = function ( base, urlInfo ) {
    if ( urlInfo.pathname ) {
        return Path.join( base, urlInfo.host, urlInfo.pathname );
    }
    return Path.join( base, urlInfo.host );
};

// url
Editor.url = function (url) {
    // NOTE: we cache app:// and editor-framework:// protocol to get rid of ipc-sync function calls
    var urlInfo = Url.parse(url);
    if ( urlInfo.protocol === 'app:' ) {
        return _urlToPath( Editor.cwd, urlInfo );
    }
    else if ( urlInfo.protocol === 'editor-framework:' ) {
        return _urlToPath( Editor.frameworkPath, urlInfo );
    }

    // try ipc-sync function
    return Editor.remote.url(url);
};

// ==========================
// console log API
// ==========================

/**
 * Log the normal message and show on the console.
 * The method will send ipc message `console:log` to core.
 * @param {...*} [arg] - whatever arguments the message needs
 */
Editor.log = function ( text ) {
    'use strict';

    if ( arguments.length &lt;= 1 ) {
        text = '' + text;
    } else {
        text = Util.format.apply(Util, arguments);
    }
    console.log(text);
    Editor.sendToCore('console:log', text);
};

Editor.success = function ( text ) {
    'use strict';

    if ( arguments.length &lt;= 1 ) {
        text = '' + text;
    } else {
        text = Util.format.apply(Util, arguments);
    }
    console.log('%c' + text, 'color: green');
    Editor.sendToCore('console:success', text);
};

Editor.failed = function ( text ) {
    'use strict';

    if ( arguments.length &lt;= 1 ) {
        text = '' + text;
    } else {
        text = Util.format.apply(Util, arguments);
    }
    console.log('%c' + text, 'color: red');
    Editor.sendToCore('console:failed', text);
};

Editor.info = function ( text ) {
    'use strict';

    if ( arguments.length &lt;= 1 ) {
        text = '' + text;
    } else {
        text = Util.format.apply(Util, arguments);
    }
    console.info(text);
    Editor.sendToCore('console:info', text);
};

Editor.warn = function ( text ) {
    'use strict';

    if ( arguments.length &lt;= 1 ) {
        text = '' + text;
    } else {
        text = Util.format.apply(Util, arguments);
    }
    console.warn(text);

    var e = new Error('dummy');
    var lines = e.stack.split('\n');
    text = text + '\n' + lines.splice(2).join('\n');

    Editor.sendToCore('console:warn', text);
};

Editor.error = function ( text ) {
    'use strict';

    if ( arguments.length &lt;= 1 ) {
        text = '' + text;
    } else {
        text = Util.format.apply(Util, arguments);
    }
    console.error(text);

    var e = new Error('dummy');
    var lines = e.stack.split('\n');
    text = text + '\n' + lines.splice(2).join('\n');

    Editor.sendToCore('console:error',text);
};

// ==========================
// pre-require modules
// ==========================

require('../share/platform');
Editor.JS = require('../share/js-utils');
Editor.Utils = require('../share/editor-utils');
require('../share/math');
Editor.Easing = require('../share/easing');
require('./ipc-init');
Editor.Selection = require('../share/selection');
Editor.KeyCode = require('../share/keycode');

// ==========================
// Layout API
// ==========================

Editor.loadLayout = function ( anchorEL, cb ) {
    Editor.sendRequestToCore( 'window:query-layout', Editor.requireIpcEvent, function (layout, needReset) {
        if ( !layout ) {
            if (cb) cb ( false );
            return;
        }

        // NOTE: needReset implies this is a default layout
        Editor.resetLayout( anchorEL, layout, function () {
            if (cb) cb ( needReset );
        });
    });
};

var _layouting = false;
Editor.resetLayout = function ( anchorEL, layoutInfo, cb ) {
    _layouting = true;

    Editor.Panel.closeAll(function () {
        var importList = EditorUI.createLayout( anchorEL, layoutInfo );
        Async.each( importList, function ( item, done ) {
            Editor.Panel.load (item.panelID, function ( err, frameEL ) {
                if ( err ) {
                    done();
                    return;
                }

                var dockAt = item.dockEL;
                dockAt.add(frameEL);
                if ( item.active ) {
                    dockAt.select(frameEL);
                }
                done();
            });
        }, function ( err ) {
            _layouting = false;

            // close error panels
            EditorUI.DockUtils.flushWithCollapse();
            Editor.saveLayout();
            if ( cb ) cb ();
        });
    });
};

Editor.saveLayout = function () {
    // don't save layout when we are layouting
    if ( _layouting )
        return;

    window.requestAnimationFrame ( function () {
        Editor.sendToCore('window:save-layout', Editor.Panel.dumpLayout(), Editor.requireIpcEvent);
    });
};

// ==========================
// Ipc events
// ==========================

Ipc.on( 'editor:reset-layout', function ( layoutInfo ) {
    var anchorEL = document.body;
    if ( EditorUI.DockUtils.root ) {
        anchorEL = Polymer.dom(EditorUI.DockUtils.root).parentNode;
    }

    Editor.resetLayout( anchorEL, layoutInfo, function () {
        EditorUI.DockUtils.reset();
    });
});

Ipc.on( 'ipc-debugger:query', function ( reply ) {
    var ipcInfos = [];
    for ( var p in Ipc._events ) {
        var listeners = Ipc._events[p];
        var count = Array.isArray(listeners) ? listeners.length : 1;
        ipcInfos.push({
            name: p,
            level: 'page',
            count: count,
        });
    }
    reply(ipcInfos);
});

// ==========================
// extends
// ==========================

Editor.registerPanel = function ( panelID, obj ) {
    if ( window[panelID] !== undefined ) {
        Editor.error('Failed to register panel %s, panelID has been registered.', panelID);
        return;
    }

    window[panelID] = Polymer(obj);
};

Editor.registerWidget = function ( widgetName, obj ) {
    if ( !window.widgets ) {
        window.widgets = {};
    }

    if ( window.widgets[widgetName] ) {
        Editor.error('Failed to register widget %s, already exists.', widgetName );
        return;
    }

    window.widgets[widgetName] = Polymer(obj);
};

// ==========================
// load modules
// ==========================

Editor.Window = require('./editor-window' );
Editor.Menu = require('./editor-menu');
Editor.Panel = require('./editor-panel');
Editor.Package = require('./editor-package');

Editor.MainMenu = require('./main-menu');
Editor.CmdP = require('./cmdp');

})();
</code></pre>
        </article>
    </section>






        

        <footer>
            Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.0</a> on Thu Jun 18 2015 14:04:04 GMT+0800 (CST)
        </footer>
    </div>
</div>
<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
<script src="scripts/main.js"></script>
</body>
</html>
